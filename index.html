<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Passport Photo Converter-</title>
<style>
body{font-family:system-ui,Segoe UI,Roboto,"Noto Sans",sans-serif;margin:20px;background:#f7fafc}
.card{background:white;padding:18px;border-radius:12px;max-width:820px;margin:0 auto;box-shadow:0 6px 18px rgba(0,0,0,0.08)}
h1{margin:0 0 8px;font-size:20px}
label{display:block;margin:10px 0 6px}
input,select,button{padding:8px;border-radius:8px;border:1px solid #d1d5db}
canvas{background:#e6eef8;border-radius:6px;max-width:100%;border:1px dashed #cbd5e1;margin-top:10px}
.help{font-size:13px;color:#475569}
.controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
</style>
</head>
<body>
<div class="card">
<h1>Passport Photo Converter - Final Working</h1>
<p class="help">Photo upload karein, background remove / resize / zoom karein aur PDF download karein.</p>

<label>Photo upload karein</label>
<input id="file" type="file" accept="image/*">

<div class="controls">
<div>
<label>Passport size (preset)</label>
<select id="size">
<option value="51x51">2x2 inch (51x51 mm)</option>
<option value="35x45">35x45 mm</option>
<option value="33x48">33x48 mm</option>
<option value="37x52">37x52 mm</option>
<option value="40x50">40x50 mm</option>
</select>
</div>
<div>
<label>DPI</label>
<input id="dpi" type="number" value="300" min="72" step="1" style="width:110px">
</div>
<div>
<label>Format</label>
<select id="format">
<option value="single">Single photo</option>
<option value="a4">A4 sheet multiple copies</option>
</select>
</div>
<div>
<label>Resize / Zoom</label>
<input id="zoom" type="range" min="0.8" max="1.5" value="1" step="0.01">
</div>
<div>
<label>Background</label>
<select id="bg">
<option value="keep">Original</option>
<option value="remove">Remove (API)</option>
<option value="white">White</option>
<option value="blue">Blue</option>
</select>
</div>
</div>

<div style="margin-top:12px">
<button id="convert">Convert & Download PDF</button>
<button id="reset" style="background:#fff;border:1px solid #e2e8f0">Reset</button>
</div>

<h3 style="margin-top:18px">Preview</h3>
<canvas id="preview" width="400" height="400"></canvas>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
// ===== Remove.bg API Key =====
const REMOVE_BG_API_KEY = "3w5gAgyJyRWPi48sFtg4krv3
"; // <--- apni key yahan paste karo

const presets = {
'51x51': {w:51,h:51},
'35x45': {w:35,h:45},
'33x48': {w:33,h:48},
'37x52': {w:37,h:52},
'40x50': {w:40,h:50}
};

const fileInput = document.getElementById('file');
const preview = document.getElementById('preview');
const ctx = preview.getContext('2d');
let loadedImg = null;
let processedImg = null;

function reset(){
ctx.clearRect(0,0,preview.width,preview.height);
loadedImg = null;
processedImg = null;
fileInput.value = '';
ctx.fillStyle='#f1f5f9';
ctx.fillRect(0,0,preview.width,preview.height);
ctx.fillStyle='#64748b';
ctx.font='16px system-ui';
ctx.fillText('Upload karke preview dekhein',20,preview.height/2);
}
document.getElementById('reset').addEventListener('click', reset);

fileInput.addEventListener('change', async e=>{
const f = e.target.files[0];
if(!f) return;
const reader = new FileReader();
reader.onload = ev=>{
const img = new Image();
img.crossOrigin="anonymous";
img.onload = ()=>{loadedImg=img;processedImg=null;drawPreview();}
img.src = ev.target.result;
}
reader.readAsDataURL(f);
});

async function drawPreview(){
if(!loadedImg) return;
const zoom = parseFloat(document.getElementById('zoom').value);
const sel = document.getElementById('size').value;
const {w:mw,h:mh} = presets[sel]||presets['51x51'];
const targetAspect = mw/mh;

const img = processedImg || loadedImg;
const sw=img.width, sh=img.height;
const imgAspect=sw/sh;
let sx,sy,swCrop,shCrop;
if(imgAspect>targetAspect){shCrop=sh;swCrop=Math.round(sh*targetAspect);sx=Math.round((sw-swCrop)/2);sy=0;}
else{swCrop=sw;shCrop=Math.round(sw/targetAspect);sx=0;sy=Math.round((sh-shCrop)/2);}

const cw=preview.width,ch=preview.height;
ctx.clearRect(0,0,cw,ch);
const dw=cw*zoom,dh=ch*zoom;
ctx.drawImage(img,sx,sy,swCrop,shCrop,(cw-dw)/2,(ch-dh)/2,dw,dh);
}

document.getElementById('zoom').addEventListener('input', drawPreview);
document.getElementById('size').addEventListener('change', drawPreview);

// ===== Remove.bg API integration =====
async function removeBackground(file){
const formData = new FormData();
formData.append("image_file", file);
formData.append("size", "auto");
const res = await fetch("https://api.remove.bg/v1.0/removebg",{
method:"POST",
headers:{"X-Api-Key":REMOVE_BG_API_KEY},
body: formData
});
const blob = await res.blob();
return new Promise(resolve=>{
const img=new Image();
img.crossOrigin="anonymous";
img.onload = ()=>resolve(img);
img.src = URL.createObjectURL(blob);
});
}

document.getElementById('bg').addEventListener('change', async ()=>{
if(!loadedImg) return;
const mode=document.getElementById('bg').value;
if(mode==='remove'){
const file=fileInput.files[0];
if(!file) return;
processedImg = await removeBackground(file);
drawPreview();
}else if(mode==='white'||mode==='blue'){
processedImg=document.createElement('canvas');
processedImg.width=loadedImg.width;
processedImg.height=loadedImg.height;
const c=processedImg.getContext('2d');
c.fillStyle=mode==='white'?'#fff':'#87ceeb';
c.fillRect(0,0,processedImg.width,processedImg.height);
c.drawImage(loadedImg,0,0);
drawPreview();
}else{
processedImg=null;
drawPreview();
}
});

// ===== PDF generation =====
async function createPassportPDF(){
if(!loadedImg){alert('Pehle photo upload karein');return;}
const img=processedImg||loadedImg;
const sel=document.getElementById('size').value;
const {w:mw,h:mh}=presets[sel]||presets['51x51'];
const dpi=parseInt(document.getElementById('dpi').value)||300;
const format=document.getElementById('format').value;
const zoom=parseFloat(document.getElementById('zoom').value);

const sw=img.width,sh=img.height;
const imgAspect=sw/sh;
const targetAspect=mw/mh;
let sx,sy,swCrop,shCrop;
if(imgAspect>targetAspect){shCrop=sh;swCrop=Math.round(sh*targetAspect);sx=Math.round((sw-swCrop)/2);sy=0;}
else{swCrop=sw;shCrop=Math.round(sw/targetAspect);sx=0;sy=Math.round((sh-shCrop)/2);}

const pxW=Math.round((mw/25.4)*dpi);
const pxH=Math.round((mh/25.4)*dpi);

const off=document.createElement('canvas');
off.width=pxW; off.height=pxH;
const offCtx=off.getContext('2d');
offCtx.fillStyle='#fff'; offCtx.fillRect(0,0,pxW,pxH);
const dw=pxW*zoom,dh=pxH*zoom;
offCtx.drawImage(img,sx,sy,swCrop,shCrop,(pxW-dw)/2,(pxH-dh)/2,dw,dh);
const imgData=off.toDataURL('image/jpeg',0.95);

const {jsPDF}=window.jspdf;
if(format==='single'){
const pdf=new jsPDF({unit:'mm',format:[mw,mh]});
pdf.addImage(imgData,'JPEG',0,0,mw,mh);
pdf.save('passport-photo.pdf');
}else{
const pdf=new jsPDF({unit:'mm',format:'a4'});
const pageW=210,pageH=297,margin=10;
const cols=Math.floor((pageW-margin*2)/mw)||1;
const rows=Math.floor((pageH-margin*2)/mh)||1;
let y=margin;
for(let r=0;r<rows;r++){
let x=margin;
for(let c=0;c<cols;c++){
pdf.addImage(imgData,'JPEG',x,y,mw,mh);
x+=mw;
}
y+=mh;
}
pdf.save('passport-photos-a4.pdf');
}
}

document.getElementById('convert').addEventListener('click',createPassportPDF);

// ===== Initial canvas text =====
ctx.fillStyle='#f1f5f9';
ctx.fillRect(0,0,preview.width,preview.height);
ctx.fillStyle='#64748b';
ctx.font='16px system-ui';
ctx.fillText('Upload karke preview dekhein',20,preview.height/2);
</script>
</body>
</html>

