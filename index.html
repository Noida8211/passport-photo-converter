<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>पासपोर्ट फोटो मेकर</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen">
  <div class="bg-white p-8 rounded-lg shadow-lg max-w-md w-full">
    <h1 class="text-2xl font-bold text-center mb-4">पासपोर्ट साइज फोटो मेकर</h1>
    <p class="text-center mb-4">अपनी फोटो अपलोड करें!</p>
    
    <input type="file" id="photoInput" accept="image/*" class="mb-4 w-full p-2 border rounded">
    
    <div class="mb-4">
      <label for="sizeSelect" class="block text-sm font-medium">साइज चुनें:</label>
      <select id="sizeSelect" class="w-full p-2 border rounded">
        <option value="2x2">2x2 इंच</option>
        <option value="35x45">35x45 मिमी</option>
      </select>
    </div>
    
    <div class="mb-4">
      <label for="bgRemove" class="block text-sm font-medium">बैकग्राउंड हटाएँ:</label>
      <input type="checkbox" id="bgRemove" class="mr-2"> हाँ, सफेद बैकग्राउंड
    </div>
    
    <div id="bgColorDiv" class="mb-4 hidden">
      <label for="bgColor" class="block text-sm font-medium">बैकग्राउंड रंग चुनें:</label>
      <input type="color" id="bgColor" value="#00ff00" class="w-full p-1 border rounded">
    </div>
    
    <button id="processBtn" class="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600">प्रोसेस करें</button>
    
    <canvas id="photoCanvas" class="hidden"></canvas>
    
    <div id="preview" class="mt-4 hidden">
      <h2 class="text-lg font-semibold">प्रीव्यू</h2>
      <img id="previewImg" class="mt-2 border w-full" alt="प्रीव्यू">
    </div>
    
    <a id="downloadLink" class="mt-4 inline-block w-full bg-green-500 text-white p-2 rounded hover:bg-green-600 text-center hidden">डाउनलोड करें</a>
    
    <div id="errorMsg" class="mt-4 text-red-500 hidden"></div>
  </div>

  <script>
    const photoInput = document.getElementById('photoInput');
    const sizeSelect = document.getElementById('sizeSelect');
    const bgRemove = document.getElementById('bgRemove');
    const bgColorDiv = document.getElementById('bgColorDiv');
    const bgColor = document.getElementById('bgColor');
    const processBtn = document.getElementById('processBtn');
    const photoCanvas = document.getElementById('photoCanvas');
    const previewImg = document.getElementById('previewImg');
    const downloadLink = document.getElementById('downloadLink');
    const previewDiv = document.getElementById('preview');
    const errorMsg = document.getElementById('errorMsg');
    const ctx = photoCanvas.getContext('2d');

    // एरर दिखाने का फंक्शन
    function showError(msg) {
      errorMsg.textContent = msg;
      errorMsg.classList.remove('hidden');
      setTimeout(() => errorMsg.classList.add('hidden'), 5000);
    }

    // चेकबॉक्स पर क्लिक
    bgRemove.addEventListener('change', () => {
      bgColorDiv.classList.toggle('hidden', !bgRemove.checked);
    });

    // फोटो अपलोड
    photoInput.addEventListener('change', function(event) {
      const file = event.target.files[0];
      if (!file) return;
      if (!file.type.startsWith('image/')) {
        showError('कृपया एक वैध इमेज फाइल चुनें!');
        return;
      }
      const img = new Image();
      img.onload = function() {
        photoCanvas.width = img.width;
        photoCanvas.height = img.height;
        ctx.drawImage(img, 0, 0);
        errorMsg.classList.add('hidden');
      };
      img.onerror = () => showError('फोटो लोड करने में समस्या!');
      img.src = URL.createObjectURL(file);
    });

    // हेक्स को RGB
    function hexToRgb(hex) {
      const r = parseInt(hex.slice(1, 3), 16);
      const g = parseInt(hex.slice(3, 5), 16);
      const b = parseInt(hex.slice(5, 7), 16);
      return { r, g, b };
    }

    // बैकग्राउंड रिमूवल (बेहतर थ्रेशोल्ड)
    function removeBackground() {
      const imageData = ctx.getImageData(0, 0, photoCanvas.width, photoCanvas.height);
      const data = imageData.data;
      const selectedColor = hexToRgb(bgColor.value);
      const threshold = 60; // और संवेदनशील बनाया

      for (let i = 0; i < data.length; i += 4) {
        const r = data[i];
        const g = data[i + 1];
        const b = data[i + 2];
        const diff = Math.abs(r - selectedColor.r) + Math.abs(g - selectedColor.g) + Math.abs(b - selectedColor.b);
        if (diff < threshold) {
          data[i] = 255;
          data[i + 1] = 255;
          data[i + 2] = 255;
          data[i + 3] = 255;
        }
      }
      ctx.putImageData(imageData, 0, 0);
    }

    // प्रोसेस (इवेंट को 'click' ठीक किया)
    processBtn.addEventListener('click', function() {
      if (!photoInput.files[0]) {
        showError('कृपया पहले फोटो अपलोड करें!');
        return;
      }
      const img = new Image();
      img.src = photoCanvas.toDataURL();
      img.onload = function() {
        try {
          if (bgRemove.checked) {
            removeBackground();
          }

          const size = sizeSelect.value;
          let targetWidth, targetHeight;
          if (size === '2x2') {
            targetWidth = 600;
            targetHeight = 600;
          } else {
            targetWidth = 413;
            targetHeight = 531;
          }

          const sourceSize = Math.min(img.width, img.height);
          const sourceX = (img.width - sourceSize) / 2;
          const sourceY = (img.height - sourceSize) / 2;

          photoCanvas.width = targetWidth;
          photoCanvas.height = targetHeight;
          ctx.fillStyle = '#ffffff';
          ctx.fillRect(0, 0, targetWidth, targetHeight);
          ctx.drawImage(img, sourceX, sourceY, sourceSize, sourceSize, 0, 0, targetWidth, targetHeight);

          previewImg.src = photoCanvas.toDataURL();
          previewDiv.classList.remove('hidden');

          downloadLink.href = photoCanvas.toDataURL('image/jpeg');
          downloadLink.download = 'passport_photo.jpg';
          downloadLink.classList.remove('hidden');
          errorMsg.classList.add('hidden');
        } catch (e) {
          showError('प्रोसेसिंग में त्रुटि: ' + e.message);
        }
      };
    });
  </script>
</body>
</html><!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Passport Photo Converter - Final Fixed</title>
<style>
body{font-family:system-ui,Segoe UI,Roboto,"Noto Sans",sans-serif;margin:20px;background:#f7fafc}
.card{background:white;padding:18px;border-radius:12px;max-width:820px;margin:0 auto;box-shadow:0 6px 18px rgba(0,0,0,0.08)}
h1{margin:0 0 8px;font-size:20px}
label{display:block;margin:10px 0 6px}
input,select,button{padding:8px;border-radius:8px;border:1px solid #d1d5db}
.row{display:flex;gap:12px;align-items:center}
canvas{background:#e6eef8;border-radius:6px;max-width:100%;border:1px dashed #cbd5e1;margin-top:10px}
.help{font-size:13px;color:#475569}
.controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
</style>
</head>
<body>
<div class="card">
<h1>Passport Photo Converter - Final Fixed</h1>
<p class="help">Photo upload karein, background remove / resize / zoom karein aur PDF download karein.</p>

<label>Photo upload karein</label>
<input id="file" type="file" accept="image/*">

<div class="controls">
<div>
<label>Passport size (preset)</label>
<select id="size">
<option value="51x51">2x2 inch (51x51 mm)</option>
<option value="35x45">35x45 mm</option>
<option value="33x48">33x48 mm</option>
<option value="37x52">37x52 mm</option>
<option value="40x50">40x50 mm</option>
</select>
</div>
<div>
<label>DPI</label>
<input id="dpi" type="number" value="300" min="72" step="1" style="width:110px">
</div>
<div>
<label>Format</label>
<select id="format">
<option value="single">Single photo</option>
<option value="a4">A4 sheet multiple copies</option>
</select>
</div>
<div>
<label>Resize / Zoom</label>
<input id="zoom" type="range" min="0.8" max="1.5" value="1" step="0.01">
</div>
<div>
<label>Background</label>
<select id="bg">
<option value="keep">Original</option>
<option value="remove">Remove (API)</option>
<option value="white">White</option>
<option value="blue">Blue</option>
</select>
</div>
</div>

<div style="margin-top:12px">
<button id="convert">Convert & Download PDF</button>
<button id="reset" style="background:#fff;border:1px solid #e2e8f0">Reset</button>
</div>

<h3 style="margin-top:18px">Preview</h3>
<canvas id="preview" width="400" height="400"></canvas>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
// ===== Remove.bg API Key =====
const REMOVE_BG_API_KEY = "3w5gAgyJyRWPi48sFtg4krv3
"; // <--- apni key yahan paste karo

const presets = {
'51x51': {w:51,h:51},
'35x45': {w:35,h:45},
'33x48': {w:33,h:48},
'37x52': {w:37,h:52},
'40x50': {w:40,h:50}
};

const fileInput = document.getElementById('file');
const preview = document.getElementById('preview');
const ctx = preview.getContext('2d');
let l

